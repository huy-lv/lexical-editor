"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("./index-DckIzJDp.cjs"),f=require("@lexical/utils"),r=require("lexical"),u=require("react"),q=require("react-error-boundary");function R({equation:i,setEquation:d,inline:l},t){const o=n=>{d(n.target.value)};return l&&r.isHTMLElement(t)?e.jsxRuntimeExports.jsxs("span",{className:"EquationEditor_inputBackground",children:[e.jsxRuntimeExports.jsx("span",{className:"EquationEditor_dollarSign",children:"$"}),e.jsxRuntimeExports.jsx("input",{className:"EquationEditor_inlineEditor",value:i,onChange:o,autoFocus:!0,ref:t}),e.jsxRuntimeExports.jsx("span",{className:"EquationEditor_dollarSign",children:"$"})]}):e.jsxRuntimeExports.jsxs("div",{className:"EquationEditor_inputBackground",children:[e.jsxRuntimeExports.jsx("span",{className:"EquationEditor_dollarSign",children:`$$
`}),e.jsxRuntimeExports.jsx("textarea",{className:"EquationEditor_blockEditor",value:i,onChange:o,ref:t}),e.jsxRuntimeExports.jsx("span",{className:"EquationEditor_dollarSign",children:`
$$`})]})}const g=u.forwardRef(R);function N({equation:i,inline:d,nodeKey:l}){const[t]=e.o(),o=e.a(),[n,j]=u.useState(i),[c,x]=u.useState(!1),m=u.useRef(null),p=u.useCallback(a=>{x(!1),t.update(()=>{const s=r.$getNodeByKey(l);e.$isEquationNode(s)&&(s.setEquation(n),a&&s.selectNext(0,0))})},[t,n,l]);return u.useEffect(()=>{!c&&n!==i&&j(i)},[c,i,n]),u.useEffect(()=>{if(o)return c?f.mergeRegister(t.registerCommand(r.SELECTION_CHANGE_COMMAND,a=>{const s=document.activeElement;return m.current!==s&&p(),!1},r.COMMAND_PRIORITY_HIGH),t.registerCommand(r.KEY_ESCAPE_COMMAND,a=>{const s=document.activeElement;return m.current===s?(p(!0),!0):!1},r.COMMAND_PRIORITY_HIGH)):t.registerUpdateListener(({editorState:a})=>{a.read(()=>{const E=r.$getSelection();return r.$isNodeSelection(E)&&E.has(l)&&E.getNodes().length===1})&&x(!0)})},[t,l,p,c,o]),e.jsxRuntimeExports.jsx(e.jsxRuntimeExports.Fragment,{children:c&&o?e.jsxRuntimeExports.jsx(g,{equation:n,setEquation:j,inline:d,ref:m}):e.jsxRuntimeExports.jsx(q.ErrorBoundary,{onError:a=>t._onError(a),fallback:null,children:e.jsxRuntimeExports.jsx(e.KatexRenderer,{equation:n,inline:d,onDoubleClick:()=>{o&&x(!0)}})})})}exports.default=N;
