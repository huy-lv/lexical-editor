"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("./index-DjceHJ_I.cjs"),L=require("./LexicalAutoFocusPlugin.prod-NBZ1Vvmq.cjs"),P=require("./LexicalNestedComposer.prod-CihwzZGC.cjs"),$=require("@lexical/utils"),t=require("lexical"),o=require("react"),b=new Set;function y(i){if(!b.has(i))throw new Promise(m=>{const r=new Image;r.src=i,r.onload=()=>{b.add(i),m(null)}})}function k({altText:i,className:m,imageRef:r,src:j,width:l,height:c,position:a}){return y(j),e.jsxRuntimeExports.jsx("img",{className:m||void 0,src:j,alt:i,ref:r,"data-position":a,style:{display:"block",height:c,width:l},draggable:"false"})}function A({activeEditor:i,nodeKey:m,onClose:r}){const l=i.getEditorState().read(()=>t.$getNodeByKey(m)),[c,a]=o.useState(l.getAltText()),[f,S]=o.useState(l.getShowCaption()),[h,E]=o.useState(l.getPosition()),R=x=>{S(x.target.checked)},d=x=>{E(x.target.value)},p=()=>{const x={altText:c,position:h,showCaption:f};l&&i.update(()=>{l.update(x)}),r()};return e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsx("div",{style:{marginBottom:"1em"},children:e.jsxRuntimeExports.jsx(e.TextInput,{label:"Alt Text",placeholder:"Descriptive alternative text",onChange:a,value:c,"data-test-id":"image-modal-alt-text-input"})}),e.jsxRuntimeExports.jsxs(e.Select,{style:{marginBottom:"1em",width:"208px"},value:h,label:"Position",name:"position",id:"position-select",onChange:d,children:[e.jsxRuntimeExports.jsx("option",{value:"left",children:"Left"}),e.jsxRuntimeExports.jsx("option",{value:"right",children:"Right"}),e.jsxRuntimeExports.jsx("option",{value:"full",children:"Full Width"})]}),e.jsxRuntimeExports.jsxs("div",{className:"Input__wrapper",children:[e.jsxRuntimeExports.jsx("input",{id:"caption",type:"checkbox",checked:f,onChange:R}),e.jsxRuntimeExports.jsx("label",{htmlFor:"caption",children:"Show Caption"})]}),e.jsxRuntimeExports.jsx(e.DialogActions,{children:e.jsxRuntimeExports.jsx(e.Button,{"data-test-id":"image-modal-file-upload-btn",onClick:()=>p(),children:"Confirm"})})]})}function w({src:i,altText:m,nodeKey:r,width:j,height:l,showCaption:c,caption:a,position:f}){const[S,h]=e.useModal(),E=o.useRef(null),R=o.useRef(null),[d,p,x]=e.u(r),[n]=e.o(),[I,D]=o.useState(null),N=o.useRef(null),_=e.a(),M=o.useCallback(u=>{const g=t.$getSelection(),s=R.current;if(d&&t.$isNodeSelection(g)&&g.getNodes().length===1){if(c)return t.$setSelection(null),u.preventDefault(),a.focus(),!0;if(s!==null&&s!==document.activeElement)return u.preventDefault(),s.focus(),!0}return!1},[a,d,c]),O=o.useCallback(u=>N.current===a||R.current===u.target?(t.$setSelection(null),n.update(()=>{p(!0);const g=n.getRootElement();g!==null&&g.focus()}),!0):!1,[a,n,p]);o.useEffect(()=>{let u=!0;const g=$.mergeRegister(n.registerUpdateListener(({editorState:s})=>{u&&D(s.read(()=>t.$getSelection()))}),n.registerCommand(t.SELECTION_CHANGE_COMMAND,(s,C)=>(N.current=C,!1),t.COMMAND_PRIORITY_LOW),n.registerCommand(t.CLICK_COMMAND,s=>{const C=s;return C.target===E.current?(C.shiftKey?p(!d):(x(),p(!0)),!0):!1},t.COMMAND_PRIORITY_LOW),n.registerCommand(t.DRAGSTART_COMMAND,s=>s.target===E.current?(s.preventDefault(),!0):!1,t.COMMAND_PRIORITY_LOW),n.registerCommand(t.KEY_ENTER_COMMAND,M,t.COMMAND_PRIORITY_LOW),n.registerCommand(t.KEY_ESCAPE_COMMAND,O,t.COMMAND_PRIORITY_LOW));return()=>{u=!1,g()}},[x,n,d,r,M,O,p]);const v=d&&t.$isNodeSelection(I),T=d&&_;return e.jsxRuntimeExports.jsxs(o.Suspense,{fallback:null,children:[e.jsxRuntimeExports.jsxs(e.jsxRuntimeExports.Fragment,{children:[e.jsxRuntimeExports.jsxs("span",{draggable:v,children:[_&&e.jsxRuntimeExports.jsx("button",{className:"image-edit-button",ref:R,onClick:()=>{h("Update Inline Image",u=>e.jsxRuntimeExports.jsx(A,{activeEditor:n,nodeKey:r,onClose:u}))},children:"Edit"}),e.jsxRuntimeExports.jsx(k,{className:T?`focused ${t.$isNodeSelection(I)?"draggable":""}`:null,src:i,altText:m,imageRef:E,width:j,height:l,position:f})]}),c&&e.jsxRuntimeExports.jsx("span",{className:"image-caption-container",children:e.jsxRuntimeExports.jsxs(P.h,{initialEditor:a,children:[e.jsxRuntimeExports.jsx(L.o,{}),e.jsxRuntimeExports.jsx(e.LinkPlugin,{}),e.jsxRuntimeExports.jsx(e.h,{contentEditable:e.jsxRuntimeExports.jsx(e.LexicalContentEditable,{placeholder:"Enter a caption...",placeholderClassName:"InlineImageNode__placeholder",className:"InlineImageNode__contentEditable"}),ErrorBoundary:e.a$2})]})})]}),S]})}exports.UpdateInlineImageDialog=A;exports.default=w;
