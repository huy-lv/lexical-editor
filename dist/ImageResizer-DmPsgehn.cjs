"use strict";const c=require("./index-DjceHJ_I.cjs"),D=require("@lexical/utils"),f=require("react");function z(h,g,p){return Math.min(Math.max(h,g),p)}const r={east:1,north:8,south:2,west:4};function Y({onResizeStart:h,onResizeEnd:g,buttonRef:p,imageRef:x,maxWidth:R,editor:v,showCaption:j,setShowCaption:N,captionsEnabled:C}){const w=f.useRef(null),d=f.useRef({priority:"",value:"default"}),y=f.useRef({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),a=v.getRootElement(),P=R||(a!==null?a.getBoundingClientRect().width-20:100),L=a!==null?a.getBoundingClientRect().height-20:100,E=100,X=100,$=t=>{const s=t===r.east||t===r.west,e=t===r.north||t===r.south,l=t&r.north&&t&r.west||t&r.south&&t&r.east,o=s?"ew":e?"ns":l?"nwse":"nesw";a!==null&&a.style.setProperty("cursor",`${o}-resize`,"important"),document.body!==null&&(document.body.style.setProperty("cursor",`${o}-resize`,"important"),d.current.value=document.body.style.getPropertyValue("-webkit-user-select"),d.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))},M=()=>{a!==null&&a.style.setProperty("cursor","text"),document.body!==null&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",d.current.value,d.current.priority))},u=(t,s)=>{if(!v.isEditable())return;const e=x.current,l=w.current;if(e!==null&&l!==null){t.preventDefault();const{width:o,height:m}=e.getBoundingClientRect(),n=D.calculateZoomLevel(e),i=y.current;i.startWidth=o,i.startHeight=m,i.ratio=o/m,i.currentWidth=o,i.currentHeight=m,i.startX=t.clientX/n,i.startY=t.clientY/n,i.isResizing=!0,i.direction=s,$(s),h(),l.classList.add("image-control-wrapper--resizing"),e.style.height=`${m}px`,e.style.width=`${o}px`,document.addEventListener("pointermove",b),document.addEventListener("pointerup",W)}},b=t=>{const s=x.current,e=y.current,l=e.direction&(r.east|r.west),o=e.direction&(r.south|r.north);if(s!==null&&e.isResizing){const m=D.calculateZoomLevel(s);if(l&&o){let n=Math.floor(e.startX-t.clientX/m);n=e.direction&r.east?-n:n;const i=z(e.startWidth+n,E,P),H=i/e.ratio;s.style.width=`${i}px`,s.style.height=`${H}px`,e.currentHeight=H,e.currentWidth=i}else if(o){let n=Math.floor(e.startY-t.clientY/m);n=e.direction&r.south?-n:n;const i=z(e.startHeight+n,X,L);s.style.height=`${i}px`,e.currentHeight=i}else{let n=Math.floor(e.startX-t.clientX/m);n=e.direction&r.east?-n:n;const i=z(e.startWidth+n,E,P);s.style.width=`${i}px`,e.currentWidth=i}}},W=()=>{const t=x.current,s=y.current,e=w.current;if(t!==null&&e!==null&&s.isResizing){const l=s.currentWidth,o=s.currentHeight;s.startWidth=0,s.startHeight=0,s.ratio=0,s.startX=0,s.startY=0,s.currentWidth=0,s.currentHeight=0,s.isResizing=!1,e.classList.remove("image-control-wrapper--resizing"),M(),g(l,o),document.removeEventListener("pointermove",b),document.removeEventListener("pointerup",W)}};return c.jsxRuntimeExports.jsxs("div",{ref:w,children:[!j&&C&&c.jsxRuntimeExports.jsx("button",{className:"image-caption-button",ref:p,onClick:()=>{N(!j)},children:"Add Caption"}),c.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-n",onPointerDown:t=>{u(t,r.north)}}),c.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-ne",onPointerDown:t=>{u(t,r.north|r.east)}}),c.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-e",onPointerDown:t=>{u(t,r.east)}}),c.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-se",onPointerDown:t=>{u(t,r.south|r.east)}}),c.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-s",onPointerDown:t=>{u(t,r.south)}}),c.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-sw",onPointerDown:t=>{u(t,r.south|r.west)}}),c.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-w",onPointerDown:t=>{u(t,r.west)}}),c.jsxRuntimeExports.jsx("div",{className:"image-resizer image-resizer-nw",onPointerDown:t=>{u(t,r.north|r.west)}})]})}exports.ImageResizer=Y;
