"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("./index-DjceHJ_I.cjs"),C=require("./LexicalCollaborationContext.prod-D-ElPwCy.cjs"),f=require("@lexical/utils"),m=require("lexical"),_=require("react");function v(o){return o.reduce((n,l)=>n+l.votes.length,0)}function P({option:o,index:n,options:l,totalVotes:r,withPollNode:x}){const{clientID:a}=C.l(),j=_.useRef(null),p=o.votes,N=p.indexOf(a)!==-1,i=p.length,h=o.text;return e.jsxRuntimeExports.jsxs("div",{className:"PollNode__optionContainer",children:[e.jsxRuntimeExports.jsx("div",{className:e.joinClasses("PollNode__optionCheckboxWrapper",N&&"PollNode__optionCheckboxChecked"),children:e.jsxRuntimeExports.jsx("input",{ref:j,className:"PollNode__optionCheckbox",type:"checkbox",onChange:d=>{x(s=>{s.toggleVote(o,a)})},checked:N})}),e.jsxRuntimeExports.jsxs("div",{className:"PollNode__optionInputWrapper",children:[e.jsxRuntimeExports.jsx("div",{className:"PollNode__optionInputVotes",style:{width:`${i===0?0:i/r*100}%`}}),e.jsxRuntimeExports.jsx("span",{className:"PollNode__optionInputVotesCount",children:i>0&&(i===1?"1 vote":`${i} votes`)}),e.jsxRuntimeExports.jsx("input",{className:"PollNode__optionInput",type:"text",value:h,onChange:d=>{const s=d.target,t=s.value,c=s.selectionStart,u=s.selectionEnd;x(g=>{g.setOptionText(o,t)},()=>{s.selectionStart=c,s.selectionEnd=u})},placeholder:`Option ${n+1}`})]}),e.jsxRuntimeExports.jsx("button",{disabled:l.length<3,className:e.joinClasses("PollNode__optionDelete",l.length<3&&"PollNode__optionDeleteDisabled"),"aria-label":"Remove",onClick:()=>{x(d=>{d.deleteOption(o)})}})]})}function E({question:o,options:n,nodeKey:l}){const[r]=e.o(),x=_.useMemo(()=>v(n),[n]),[a,j,p]=e.u(l),[R,N]=_.useState(null),i=_.useRef(null);_.useEffect(()=>f.mergeRegister(r.registerUpdateListener(({editorState:t})=>{N(t.read(()=>m.$getSelection()))}),r.registerCommand(m.CLICK_COMMAND,t=>{const c=t;return c.target===i.current?(c.shiftKey||p(),j(!a),!0):!1},m.COMMAND_PRIORITY_LOW)),[p,r,a,l,j]);const h=(t,c)=>{r.update(()=>{const u=m.$getNodeByKey(l);e.$isPollNode(u)&&t(u)},{onUpdate:c})},d=()=>{h(t=>{t.addOption(e.createPollOption())})},s=m.$isNodeSelection(R)&&a;return e.jsxRuntimeExports.jsx("div",{className:`PollNode__container ${s?"focused":""}`,ref:i,children:e.jsxRuntimeExports.jsxs("div",{className:"PollNode__inner",children:[e.jsxRuntimeExports.jsx("h2",{className:"PollNode__heading",children:o}),n.map((t,c)=>{const u=t.uid;return e.jsxRuntimeExports.jsx(P,{withPollNode:h,option:t,index:c,options:n,totalVotes:x},u)}),e.jsxRuntimeExports.jsx("div",{className:"PollNode__footer",children:e.jsxRuntimeExports.jsx(e.Button,{onClick:d,small:!0,children:"Add Option"})})]})})}exports.default=E;
