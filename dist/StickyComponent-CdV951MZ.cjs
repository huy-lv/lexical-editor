"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const t=require("./index-j4rxvZK9.cjs"),S=require("./LexicalCollaborationContext.prod-D-ElPwCy.cjs"),$=require("./LexicalCollaborationPlugin.prod-DqIJv0Ns.cjs"),D=require("./LexicalNestedComposer.prod-BfxaBj9J.cjs"),k=require("@lexical/utils"),E=require("lexical"),p=require("react");function y(m,a){const u=m.style,d=a.rootElementRect,g=d!==null?d.left:0,c=d!==null?d.top:0;u.top=c+a.y+"px",u.left=g+a.x+"px"}function B({x:m,y:a,nodeKey:u,color:d,caption:g}){const[c]=t.o(),l=p.useRef(null),f=p.useRef({isDragging:!1,offsetX:0,offsetY:0,rootElementRect:null,x:0,y:0}),{isCollabActive:v}=S.l();p.useEffect(()=>{const e=f.current;e.x=m,e.y=a;const n=l.current;n!==null&&y(n,e)},[m,a]),p.useLayoutEffect(()=>{const e=f.current,n=new ResizeObserver(i=>{for(let r=0;r<i.length;r++){const x=i[r],{target:N}=x;e.rootElementRect=N.getBoundingClientRect();const h=l.current;h!==null&&y(h,e)}}),o=c.registerRootListener((i,r)=>{r!==null&&n.unobserve(r),i!==null&&n.observe(i)}),s=()=>{const i=c.getRootElement(),r=l.current;i!==null&&r!==null&&(e.rootElementRect=i.getBoundingClientRect(),y(r,e))};return window.addEventListener("resize",s),()=>{window.removeEventListener("resize",s),o()}},[c]),p.useEffect(()=>{const e=l.current;e!==null&&setTimeout(()=>{e.style.setProperty("transition","top 0.3s ease 0s, left 0.3s ease 0s")},500)},[]);const C=e=>{const n=l.current,o=f.current,s=o.rootElementRect,i=k.calculateZoomLevel(n);n!==null&&o.isDragging&&s!==null&&(o.x=e.pageX/i-o.offsetX-s.left,o.y=e.pageY/i-o.offsetY-s.top,y(n,o))},R=e=>{const n=l.current,o=f.current;n!==null&&(o.isDragging=!1,n.classList.remove("dragging"),c.update(()=>{const s=E.$getNodeByKey(u);t.$isStickyNode(s)&&s.setPosition(o.x,o.y)})),document.removeEventListener("pointermove",C),document.removeEventListener("pointerup",R)},j=()=>{c.update(()=>{const e=E.$getNodeByKey(u);t.$isStickyNode(e)&&e.remove()})},b=()=>{c.update(()=>{const e=E.$getNodeByKey(u);t.$isStickyNode(e)&&e.toggleColor()})},{historyState:L}=t.useSharedHistoryContext();return t.jsxRuntimeExports.jsx("div",{ref:l,className:"sticky-note-container",children:t.jsxRuntimeExports.jsxs("div",{className:`sticky-note ${d}`,onPointerDown:e=>{const n=l.current;if(n==null||e.button===2||e.target!==n.firstChild)return;const o=n,s=f.current;if(o!==null){const{top:i,left:r}=o.getBoundingClientRect(),x=k.calculateZoomLevel(o);s.offsetX=e.clientX/x-r,s.offsetY=e.clientY/x-i,s.isDragging=!0,o.classList.add("dragging"),document.addEventListener("pointermove",C),document.addEventListener("pointerup",R),e.preventDefault()}},children:[t.jsxRuntimeExports.jsx("button",{onClick:j,className:"delete","aria-label":"Delete sticky note",title:"Delete",children:"X"}),t.jsxRuntimeExports.jsx("button",{onClick:b,className:"color","aria-label":"Change sticky note color",title:"Color",children:t.jsxRuntimeExports.jsx("i",{className:"bucket"})}),t.jsxRuntimeExports.jsxs(D.h,{initialEditor:g,initialTheme:t.theme,children:[v?t.jsxRuntimeExports.jsx($._,{id:g.getKey(),providerFactory:t.createWebsocketProvider,shouldBootstrap:!0}):t.jsxRuntimeExports.jsx(t.a$1,{externalHistoryState:L}),t.jsxRuntimeExports.jsx(t.h$1,{contentEditable:t.jsxRuntimeExports.jsx(t.LexicalContentEditable,{placeholder:"What's up?",placeholderClassName:"StickyNode__placeholder",className:"StickyNode__contentEditable"}),ErrorBoundary:t.a$2})]})]})})}exports.default=B;
